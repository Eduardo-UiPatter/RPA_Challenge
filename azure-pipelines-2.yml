# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: windows-latest

stages:
  - stage: Build
    displayName: Build Package
    jobs:
    - job: BuildPackage
      vmImage: windows-latest
      steps:
      - task: UiPathPack@4
      inputs:
      versionType: 'AutoVersion'
      projectJsonPath: '$(Build.SourcesDirectory)\project.json'
      orchestratorConnection: 'Azure DevOps'
      outputPath: '$(Build.ArtifactStagingDirectory)\Output'
      traceLevel: 'Information'

  - stage: TestDEV
    displayName:  Test After Publish
    dependsOn: DeployDEV
    condition: succeeded()
    jobs:
      - job: TestDEV
        vmImage: windows-latest
        steps:
          - task: UiPathTest@2
            inputs:
              testTarget: 'TestSet'
              orchestratorConnection: 'UiPATH RPABOTSWORLD'
              testSet: 'UiPathAzureDevOps_Tests'
              folderName: 'UCare'
              testReportDestination: '$(Pipeline.Workspace)\drop\'
